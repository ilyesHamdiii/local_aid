<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Sign Up - MutualAid</title>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto,
          Oxygen, Ubuntu, Cantarell, sans-serif;
        line-height: 1.6;
        color: #333;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        min-height: 100vh;
        display: flex;
        align-items: center;
        justify-content: center;
        padding: 2rem;
      }

      .register-container {
        background: white;
        border-radius: 20px;
        padding: 3rem;
        box-shadow: 0 20px 60px rgba(0, 0, 0, 0.2);
        width: 100%;
        max-width: 500px;
        position: relative;
        overflow: hidden;
      }

      .register-container::before {
        content: "";
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        height: 4px;
        background: linear-gradient(45deg, #667eea, #764ba2);
      }

      .logo {
        text-align: center;
        margin-bottom: 2rem;
      }

      .logo h1 {
        font-size: 2rem;
        font-weight: bold;
        color: #667eea;
        margin-bottom: 0.5rem;
      }

      .logo p {
        color: #666;
        font-size: 1rem;
      }

      .register-header {
        text-align: center;
        margin-bottom: 2rem;
      }

      .register-header h2 {
        font-size: 1.8rem;
        color: #333;
        margin-bottom: 0.5rem;
      }

      .register-header p {
        color: #666;
      }

      .form-group {
        margin-bottom: 1.5rem;
      }

      .form-group label {
        display: block;
        font-weight: 600;
        margin-bottom: 0.5rem;
        color: #333;
      }

      .form-group.required label::after {
        content: " *";
        color: #dc3545;
      }

      .form-group input,
      .form-group select {
        width: 100%;
        padding: 1rem;
        border: 2px solid #e1e5e9;
        border-radius: 10px;
        font-size: 1rem;
        font-family: inherit;
        transition: all 0.3s ease;
      }

      .form-group input:focus,
      .form-group select:focus {
        outline: none;
        border-color: #667eea;
        box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
      }

      .form-row {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 1rem;
      }

      .form-help {
        font-size: 0.8rem;
        color: #666;
        margin-top: 0.25rem;
      }

      .password-strength {
        margin-top: 0.5rem;
      }

      .strength-bar {
        height: 4px;
        background: #e1e5e9;
        border-radius: 2px;
        overflow: hidden;
        margin-bottom: 0.5rem;
      }

      .strength-fill {
        height: 100%;
        transition: all 0.3s ease;
        border-radius: 2px;
      }

      .strength-weak .strength-fill {
        width: 25%;
        background: #dc3545;
      }

      .strength-fair .strength-fill {
        width: 50%;
        background: #ffc107;
      }

      .strength-good .strength-fill {
        width: 75%;
        background: #fd7e14;
      }

      .strength-strong .strength-fill {
        width: 100%;
        background: #28a745;
      }

      .strength-text {
        font-size: 0.8rem;
        color: #666;
      }

      .checkbox-group {
        display: flex;
        align-items: flex-start;
        gap: 0.5rem;
        margin-bottom: 1.5rem;
      }

      .checkbox-group input[type="checkbox"] {
        width: auto;
        margin-top: 0.2rem;
      }

      .checkbox-group label {
        font-weight: normal;
        font-size: 0.9rem;
        line-height: 1.4;
      }

      .checkbox-group a {
        color: #667eea;
        text-decoration: none;
      }

      .checkbox-group a:hover {
        text-decoration: underline;
      }

      .btn {
        width: 100%;
        padding: 1rem;
        border: none;
        border-radius: 10px;
        font-size: 1.1rem;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s ease;
        margin-bottom: 1rem;
      }

      .btn-primary {
        background: linear-gradient(45deg, #667eea, #764ba2);
        color: white;
      }

      .btn-primary:hover {
        transform: translateY(-2px);
        box-shadow: 0 10px 25px rgba(102, 126, 234, 0.4);
      }

      .btn-primary:active {
        transform: translateY(0);
      }

      .btn-primary:disabled {
        opacity: 0.6;
        cursor: not-allowed;
        transform: none;
      }

      .divider {
        text-align: center;
        margin: 2rem 0;
        position: relative;
        color: #666;
      }

      .divider::before {
        content: "";
        position: absolute;
        top: 50%;
        left: 0;
        right: 0;
        height: 1px;
        background: #e1e5e9;
        z-index: 1;
      }

      .divider span {
        background: white;
        padding: 0 1rem;
        position: relative;
        z-index: 2;
      }

      .social-login {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 1rem;
        margin-bottom: 2rem;
      }

      .btn-social {
        padding: 0.75rem;
        border: 2px solid #e1e5e9;
        background: white;
        border-radius: 10px;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 0.5rem;
        font-weight: 500;
        color: #333;
        text-decoration: none;
        transition: all 0.3s ease;
      }

      .btn-social:hover {
        border-color: #667eea;
        color: #667eea;
        transform: translateY(-2px);
      }

      .btn-google {
        border-color: #db4437;
        color: #db4437;
      }

      .btn-google:hover {
        background: #db4437;
        color: white;
      }

      .btn-facebook {
        border-color: #4267b2;
        color: #4267b2;
      }

      .btn-facebook:hover {
        background: #4267b2;
        color: white;
      }

      .login-link {
        text-align: center;
        margin-top: 2rem;
        padding-top: 2rem;
        border-top: 1px solid #e1e5e9;
      }

      .login-link a {
        color: #667eea;
        text-decoration: none;
        font-weight: 600;
      }

      .login-link a:hover {
        text-decoration: underline;
      }

      .error-message {
        background: #f8d7da;
        color: #721c24;
        padding: 0.75rem;
        border-radius: 8px;
        margin-bottom: 1rem;
        font-size: 0.9rem;
        display: none;
      }

      .success-message {
        background: #d4edda;
        color: #155724;
        padding: 0.75rem;
        border-radius: 8px;
        margin-bottom: 1rem;
        font-size: 0.9rem;
        display: none;
      }

      .loading-overlay {
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: rgba(255, 255, 255, 0.9);
        display: none;
        align-items: center;
        justify-content: center;
        border-radius: 20px;
      }

      .loading-spinner {
        width: 40px;
        height: 40px;
        border: 4px solid #e1e5e9;
        border-top: 4px solid #667eea;
        border-radius: 50%;
        animation: spin 1s linear infinite;
      }

      @keyframes spin {
        0% {
          transform: rotate(0deg);
        }
        100% {
          transform: rotate(360deg);
        }
      }

      .back-to-home {
        position: absolute;
        top: 2rem;
        left: 2rem;
        background: rgba(255, 255, 255, 0.2);
        color: white;
        text-decoration: none;
        padding: 0.5rem 1rem;
        border-radius: 25px;
        font-weight: 500;
        transition: all 0.3s ease;
      }

      .back-to-home:hover {
        background: rgba(255, 255, 255, 0.3);
        transform: translateY(-2px);
      }

      .validation-feedback {
        font-size: 0.8rem;
        margin-top: 0.25rem;
        display: none;
      }

      .validation-feedback.valid {
        color: #28a745;
        display: block;
      }

      .validation-feedback.invalid {
        color: #dc3545;
        display: block;
      }

      @media (max-width: 480px) {
        .register-container {
          padding: 2rem;
          margin: 1rem;
        }

        .form-row {
          grid-template-columns: 1fr;
        }

        .social-login {
          grid-template-columns: 1fr;
        }
      }
    </style>
  </head>
  <body>
    <a href="{% url 'aid:home'%}" class="back-to-home">‚Üê Back to Home</a>

    <div class="register-container">
      <div class="loading-overlay" id="loading-overlay">
        <div class="loading-spinner"></div>
      </div>

      <div class="logo">
        <h1>MutualAid</h1>
        <p>Join your community network</p>
      </div>

      <div class="register-header">
        <h2>Create Account</h2>
        <p>Start helping and getting help from your neighbors</p>
      </div>

      <div class="error-message" id="error-message"></div>
      <div class="success-message" id="success-message"></div>

      <form id="register-form">
        <div class="form-row">
          <div class="form-group required">
            <label for="firstName">First Name</label>
            <input
              type="text"
              id="firstName"
              name="firstName"
              required
              placeholder="John"
            />
            <div class="validation-feedback" id="firstName-feedback"></div>
          </div>

          <div class="form-group required">
            <label for="lastName">Last Name</label>
            <input
              type="text"
              id="lastName"
              name="lastName"
              required
              placeholder="Doe"
            />
            <div class="validation-feedback" id="lastName-feedback"></div>
          </div>
        </div>

        <div class="form-group required">
          <label for="email">Email Address</label>
          <input
            type="email"
            id="email"
            name="email"
            required
            placeholder="john@example.com"
          />
          <div class="validation-feedback" id="email-feedback"></div>
        </div>

        <div class="form-group required">
          <label for="location">Location</label>
          <select id="location" name="location" required>
            {% for loc in locations%}
            <option value="{{loc.id }}">{{loc.name}}</option>
            {%endfor%}
          </select>
          <div class="form-help">
            This helps neighbors find you for local requests
          </div>
        </div>

        <div class="form-group required">
          <label for="password">Password</label>
          <input
            type="password"
            id="password"
            name="password"
            required
            placeholder="Create a strong password"
          />
          <div class="password-strength" id="password-strength">
            <div class="strength-bar">
              <div class="strength-fill"></div>
            </div>
            <div class="strength-text">Choose a strong password</div>
          </div>
        </div>

        <div class="form-group required">
          <label for="confirmPassword">Confirm Password</label>
          <input
            type="password"
            id="confirmPassword"
            name="confirmPassword"
            required
            placeholder="Confirm your password"
          />
          <div class="validation-feedback" id="confirmPassword-feedback"></div>
        </div>

        <div class="form-group">
          <label for="phone">Phone Number (Optional)</label>
          <input
            type="tel"
            id="phone"
            name="phone"
            placeholder="+1 (555) 123-4567"
          />
          <div class="form-help">For urgent requests and coordination</div>
        </div>

        <div class="checkbox-group">
          <input type="checkbox" id="terms" name="terms" required />
          <label for="terms">
            I agree to the
            <a href="#" onclick="showTerms()">Terms of Service</a> and
            <a href="#" onclick="showPrivacy()">Privacy Policy</a>
          </label>
        </div>

        <div class="checkbox-group">
          <input type="checkbox" id="newsletter" name="newsletter" />
          <label for="newsletter">
            Send me community updates and helpful tips
          </label>
        </div>

        <button type="submit" class="btn btn-primary" id="register-btn">
          Create Account
        </button>
      </form>

      <div class="divider">
        <span>Or sign up with</span>
      </div>

      <div class="social-login">
        <a
          href="#"
          class="btn-social btn-google"
          onclick="socialRegister('google')"
        >
          <span>üî¥</span> Google
        </a>
        <a
          href="#"
          class="btn-social btn-facebook"
          onclick="socialRegister('facebook')"
        >
          <span>üîµ</span> Facebook
        </a>
      </div>

      <div class="login-link">
        <p>
          Already have an account?
          <a href="{% url 'user:login'%}">Sign in here</a>
        </p>
      </div>
    </div>

    <script>
      // Form elements
      const registerForm = document.getElementById("register-form");
      const registerBtn = document.getElementById("register-btn");
      const errorMessage = document.getElementById("error-message");
      const successMessage = document.getElementById("success-message");
      const loadingOverlay = document.getElementById("loading-overlay");

      // Input elements
      const firstNameInput = document.getElementById("firstName");
      const lastNameInput = document.getElementById("lastName");
      const emailInput = document.getElementById("email");
      const passwordInput = document.getElementById("password");
      const confirmPasswordInput = document.getElementById("confirmPassword");
      const phoneInput = document.getElementById("phone");

      // Validation patterns
      const emailPattern = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
      const phonePattern = /^[\+]?[0-9\(\)\-\.\s]{10,}$/;

      // Password strength checker
      function checkPasswordStrength(password) {
        const strengthBar = document.getElementById("password-strength");
        const strengthText = strengthBar.querySelector(".strength-text");

        let score = 0;
        let feedback = "";

        if (password.length >= 8) score++;
        if (password.match(/[a-z]/)) score++;
        if (password.match(/[A-Z]/)) score++;
        if (password.match(/[0-9]/)) score++;
        if (password.match(/[^a-zA-Z0-9]/)) score++;

        // Remove previous classes
        strengthBar.className = "password-strength";

        if (score === 0) {
          feedback = "Choose a strong password";
        } else if (score <= 2) {
          strengthBar.classList.add("strength-weak");
          feedback = "Weak password";
        } else if (score === 3) {
          strengthBar.classList.add("strength-fair");
          feedback = "Fair password";
        } else if (score === 4) {
          strengthBar.classList.add("strength-good");
          feedback = "Good password";
        } else {
          strengthBar.classList.add("strength-strong");
          feedback = "Strong password";
        }

        strengthText.textContent = feedback;
        return score;
      }

      // Real-time validation
      passwordInput.addEventListener("input", function () {
        checkPasswordStrength(this.value);
      });

      confirmPasswordInput.addEventListener("input", function () {
        const feedback = document.getElementById("confirmPassword-feedback");
        if (this.value && this.value !== passwordInput.value) {
          feedback.textContent = "Passwords do not match";
          feedback.className = "validation-feedback invalid";
        } else if (this.value && this.value === passwordInput.value) {
          feedback.textContent = "Passwords match";
          feedback.className = "validation-feedback valid";
        } else {
          feedback.style.display = "none";
        }
      });

      emailInput.addEventListener("input", function () {
        const feedback = document.getElementById("email-feedback");
        if (this.value && !emailPattern.test(this.value)) {
          feedback.textContent = "Please enter a valid email address";
          feedback.className = "validation-feedback invalid";
        } else if (this.value && emailPattern.test(this.value)) {
          feedback.textContent = "Valid email address";
          feedback.className = "validation-feedback valid";
        } else {
          feedback.style.display = "none";
        }
      });

      // Form submission
      registerForm.addEventListener("submit", async function (e) {
        e.preventDefault();

        hideMessages();

        const formData = new FormData(this);
        const data = Object.fromEntries(formData.entries());

        // Validation
        if (!validateForm(data)) {
          return;
        }

        showLoading(true);

        try {
          await simulateRegistration(data);
          showSuccess("Account created successfully! Welcome to MutualAid.");

          setTimeout(() => {
            window.location.href = "{% url 'aid:requests'%}";
          }, 2000);
        } catch (error) {
          showError(error.message);
        } finally {
          showLoading(false);
        }
      });

      function validateForm(data) {
        // Check required fields
        if (
          !data.firstName ||
          !data.lastName ||
          !data.email ||
          !data.password ||
          !data.location
        ) {
          showError("Please fill in all required fields.");
          return false;
        }

        // Check email format
        if (!emailPattern.test(data.email)) {
          showError("Please enter a valid email address.");
          return false;
        }

        // Check password strength
        if (checkPasswordStrength(data.password) < 3) {
          showError("Please choose a stronger password.");
          return false;
        }

        // Check password confirmation
        if (data.password !== data.confirmPassword) {
          showError("Passwords do not match.");
          return false;
        }

        // Check terms agreement
        if (!data.terms) {
          showError("Please agree to the Terms of Service and Privacy Policy.");
          return false;
        }

        // Check phone if provided
        if (data.phone && !phonePattern.test(data.phone)) {
          showError("Please enter a valid phone number.");
          return false;
        }

        return true;
      }

      async function simulateRegistration(data) {
        // Simulate API call
        await new Promise((resolve) => setTimeout(resolve, 2000));

        // Simulate email check
        const existingEmails = ["test@example.com", "admin@mutualaid.com"];
        if (existingEmails.includes(data.email)) {
          throw new Error("An account with this email already exists.");
        }

        // Success
        return { success: true, user: data };
      }

      function socialRegister(provider) {
        showLoading(true);

        setTimeout(() => {
          showLoading(false);
          showSuccess(`Account created successfully with ${provider}!`);
          setTimeout(() => {
            window.location.href = "{% url 'aid:requests' %}";
          }, 2000);
        }, 2000);
      }

      function showError(message) {
        errorMessage.textContent = message;
        errorMessage.style.display = "block";
        successMessage.style.display = "none";
      }

      function showSuccess(message) {
        successMessage.textContent = message;
        successMessage.style.display = "block";
        errorMessage.style.display = "none";
      }

      function hideMessages() {
        errorMessage.style.display = "none";
        successMessage.style.display = "none";
      }

      function showLoading(show) {
        if (show) {
          loadingOverlay.style.display = "flex";
          registerBtn.disabled = true;
        } else {
          loadingOverlay.style.display = "none";
          registerBtn.disabled = false;
        }
      }

      function showTerms() {
        alert(
          "Terms of Service would be displayed here in a modal or separate page."
        );
      }

      function showPrivacy() {
        alert(
          "Privacy Policy would be displayed here in a modal or separate page."
        );
      }

      // Phone number formatting
      phoneInput.addEventListener("input", function () {
        let value = this.value.replace(/\D/g, "");
        if (value.length >= 6) {
          value = value.replace(/(\d{3})(\d{3})(\d{4})/, "($1) $2-$3");
        } else if (value.length >= 3) {
          value = value.replace(/(\d{3})(\d{0,3})/, "($1) $2");
        }
        this.value = value;
      });

      // Character limits
      firstNameInput.addEventListener("input", function () {
        if (this.value.length > 50) {
          this.value = this.value.substring(0, 50);
        }
      });

      lastNameInput.addEventListener("input", function () {
        if (this.value.length > 50) {
          this.value = this.value.substring(0, 50);
        }
      });
    </script>
  </body>
</html>
